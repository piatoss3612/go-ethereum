# 01.types 패키지

- 이더리움 consensus와 관련된 타입들을 정의한 패키지이므로 먼저 살펴봅니다.

## block.go

### Header

| 필드명 | 설명 | 크기 | json | 특이사항 |
|---|---| ---|---| ---|
| ParentHash | 이전 블록의 해시 | 32 bytes | parentHash |
| UncleHash | 엉클 블록의 해시 | 32 bytes | sha3Uncles |
| Coinbase | 블록 생성자의 주소 | 20 bytes | miner |
| Root | 상태 머클 패트리샤 트리의 머클루트 | 32 bytes | stateRoot |
| TxHash | 트랜잭션의 머클루트 | 32 bytes | transactionsRoot |
| ReceiptHash | 트랜잭션 영수증의 머클루트 | 32 bytes | receiptsRoot |
| Bloom | 블룸필터 | 256 bytes | logsBloom |
| Difficulty | 난이도 | ?? bytes | difficulty |
| Number | 블록 번호 | ?? bytes | number |
| GasLimit | 블록의 gas limit | ?? bytes | gasLimit |
| GasUsed | 블록에서 사용된 gas | ?? bytes | gasUsed |
| Time | 블록 생성 시간 | ?? bytes | timestamp |
| Extra | 블록의 extra data | ?? bytes | extraData |
| MixDigest | 믹스해시 | 32 bytes | mixHash |
| Nonce | 블록의 nonce | 8 bytes | nonce |
| BaseFee | 블록의 base fee | ?? bytes | baseFeePerGas | EIP-1559에서 추가(optional) |
| WithdrawalHash | validator의 인출 요청 시 발생하는 트랜잭션의 머클루트 | 32 bytes | withdrawalHash | EIP-4895에서 추가(optional) |
| BlobGasUsed | 블록에서 사용된 blob gas의 합 | ?? bytes | blobGasUsed | EIP-4844에서 추가(optional) |
| ExcessBlobGas | 블록 당 타깃 사용량을 초과한 blob gas의 양 | ?? bytes | excessBlobGas | EIP-4844에서 추가(optional) |
| ParentBeaconRoot | 이전 비콘 블록의 머클루트 | 32 bytes | parentBeaconRoot | EIP-4788에서 추가(optional) |

- 블록 해시는 RLP 인코딩된 블록 헤더의 keccak256 해시입니다.
- `?? bytes`는 RLP 직렬화에 대해 공부한 후에 다시 살펴보겠습니다.

### Body

| 필드명 | 설명 | 특이사항 |
|---|---| ---|
| Transactions | 트랜잭션 목록 | |
| Uncles | 엉클 블록 목록 | |
| Withdrawals | 출금 트랜잭션 목록 | EIP-4895에서 추가(optional) |

### Block

| 필드명 | 설명 | 특이사항 |
|---|---| ---|
| header | 블록 헤더 | |
| uncles | 엉클 블록 목록 | |
| transactions | 트랜잭션 목록 | |
| withdrawals | 출금 트랜잭션 목록 | EIP-4895에서 추가(optional) |
| hash | 블록 해시 | 처음 호출 시 계산되고 이후에는 캐싱됩니다. |
| size | 블록의 크기 | 처음 호출 시 계산되고 이후에는 캐싱됩니다. |
| ReceivedAt | 블록이 받아들여진 시간 | 피어 간 블록 릴레이에 사용됩니다. |
| ReceivedFrom | 블록을 보낸 피어의 정보 | 피어 간 블록 릴레이에 사용됩니다. |

#### 블록 불변성 규칙

- 블록 생성 시에 입력되는 모든 값은 복사되어 블록에 저장됩니다. 따라서 입력값이 변경되더라도 블록에 저장된 값은 변경되지 않습니다.
- 블록의 헤더는 블록 해시와 크기에 영향을 미치기 때문에 항상 복사하여 사용합니다.
- 새로운 바디 데이터가 블록에 추가될 때는 블록의 얕은 복사본을 만들어 사용합니다.
- 블록의 바디는 블록 해시와 크기에 영향을 미치지 않고 비용이 많이 들기 때문에 참조하여 사용합니다.

### 사용된 주요 패키지

- [github.com/fjl/gencodec](https://github.com/fjl/gencodec): 블록 헤더의 JSON 인코딩/디코딩을 위한 코드 생성기
- [github.com/ethereum/go-ethereum/rlp/rlpgen](https://github.com/ethereum/go-ethereum/tree/master/rlp/rlpgen): 블록 헤더의 RLP 인코딩을 위한 코드 생성기

### gen_header_json.go

- 블록 헤더의 JSON 인코딩/디코딩을 위한 코드가 정의되어 있습니다. 
- `go generate` 명령을 실행하면 `header_json.go` 파일이 생성됩니다.

```go
//go:generate go run github.com/fjl/gencodec -type Header -field-override headerMarshaling -out gen_header_json.go
```

### gen_header_rlp.go

- 블록 헤더의 RLP 인코딩을 위한 코드가 정의되어 있습니다.
- `go generate` 명령을 실행하면 `header_rlp.go` 파일이 생성됩니다.

```go
//go:generate go run ../../rlp/rlpgen -type Header -out gen_header_rlp.go
```

### 읽어보기

- [EIP-1559](https://eips.ethereum.org/EIPS/eip-1559)
- [EIP-4895](https://eips.ethereum.org/EIPS/eip-4895)
- [EIP-4844](https://eips.ethereum.org/EIPS/eip-4844)
- [EIP-4788](https://eips.ethereum.org/EIPS/eip-4788)